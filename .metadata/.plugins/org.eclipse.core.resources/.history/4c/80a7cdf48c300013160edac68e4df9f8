package com.example.taskmon;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.FileReader;
import java.io.InputStreamReader;

import com.jjoe64.graphview.GraphViewSeries;
import com.jjoe64.graphview.GraphView.GraphViewData;
import android.os.Handler;


public class Observer implements Runnable {

	private int pid;
	private double t;
	private Runnable mTimer;
	private Handler handler = new Handler();
	private long period;
	private GraphViewSeries dataSeries;
	
	public Observer(int pid, double t){
		this.pid = pid;
		this.t = t;
		period = (long) (t/1000000);
		dataSeries = new GraphViewSeries(new GraphViewData[]{new GraphViewData(0, 0.0d)});
	}

	public void run(){

		mTimer = new Runnable() {
			@Override
			public void run() {
				String filename = "/sys/rtes/tasks/"+pid+"/util";
				String data = null;
				try{
				BufferedReader brn = new BufferedReader(new FileReader(filename));
				data = brn.readLine();
				
				}catch(Exception e){
					e.printStackTrace();
				}
				if(!data.equals(null)){
						double dataPoint = Double.parseDouble(data);
					dataSeries.appendData(new GraphViewData(System.currentTimeMillis()
							,dataPoint), true, 100);
					ViewGraphs.graphView.addSeries(dataSeries);
					handler.postDelayed(this, period);
				}
			}
		};
		handler.postDelayed(mTimer, 1000);

	}
}
